import{u as Z}from"./BMHoVKzN.js";import{ao as ee,r as h,k as te,G as ae,y as D,A as v,C as r,H as X,I as s,ar as $,L as V,D as i,z as S,E as x,J as se,B as O,M as g}from"./CXt9CpHx.js";import{_ as ne,B as le,I as oe}from"./BiSs8nCf.js";import{M as re}from"./BJXH78id.js";import{F as ie,_ as ue}from"./DfpqhckG.js";import{_ as ce}from"./TBLQoWR7.js";import{_ as me}from"./DHdZDWaO.js";import{_ as pe}from"./BydhxjDa.js";import"./_QCYz8aP.js";import"./BQfcw6q0.js";import"./C_MGbZ-_.js";const de={class:"min-h-screen bg-white p-4"},he={class:""},_e={class:"bg-white p-3 rounded-lg shadow-sm mb-4"},ve={class:"flex flex-col md:flex-row md:items-center justify-between gap-2"},ge={class:"flex items-center gap-2"},fe={class:"bg-white"},ye={key:1,class:"flex gap-1"},Fe={__name:"product",async setup(we){let E,F;const{RestApi:C}=Z(),I=ee(),c=h({page:1,limit:10,search:""}),B=h(""),A=h([]),H=h(0),z=h(!1),_=h(!1),f=h([]),y=h(!1),k=h(null),m=h({name:"",price:0}),R=[{title:"Tên sản phẩm",dataIndex:"name",key:"name",ellipsis:!0},{title:"Giá",dataIndex:"price",key:"price",align:"right",width:"150px"},{title:"Hành động",key:"actions",width:"120px",align:"center"}],j=te(()=>({current:c.value.page,pageSize:c.value.limit,total:H.value,showSizeChanger:!0,pageSizeOptions:["1","10","20","50","100"],showTotal:t=>`Tổng ${t} sản phẩm`,size:"small"})),b=async t=>{var e,u,a,l;z.value=!0;try{const{data:n}=await C.products.list({params:t});A.value=((u=(e=n.value)==null?void 0:e.data)==null?void 0:u.products)||[],H.value=((l=(a=n.value)==null?void 0:a.data)==null?void 0:l.total)||0}finally{z.value=!1}},q=async t=>{c.value.page=t.current,c.value.limit=t.pageSize,await b({...c.value})},G=async()=>{c.value.page=1,c.value.search=B.value,await b({...c.value})},K=t=>{f.value=t},L=()=>{k.value=null,m.value={name:"",price:0},y.value=!0},P=t=>{k.value=t,Object.assign(m.value,{id:t.id,name:t.name,price:t.price||""}),y.value=!0},M=async()=>{var t,e,u,a,l,n,p,w;_.value=!0;try{if(k.value){const{data:d,error:T}=await C.products.update({body:{...m.value}});if(((t=d.value)==null?void 0:t.status)==="success")g.success(d.value.message||"Thêm mới thành công");else throw new Error(((u=(e=T.value)==null?void 0:e.data)==null?void 0:u.message)||"Thêm mới không thành công");g.success("Cập nhật sản phẩm thành công!")}else{m.value&&delete m.value.id;const{data:d,error:T}=await C.products.create({body:{...m.value}});if(((a=d.value)==null?void 0:a.status)==="success")g.success(d.value.message||"Thêm mới thành công");else throw new Error(((n=(l=T.value)==null?void 0:l.data)==null?void 0:n.message)||"Thêm mới không thành công")}}catch(d){g.error(d.message||((w=(p=d.response)==null?void 0:p.data)==null?void 0:w.message)||"Đã xảy ra lỗi khi lưu thông tin")}finally{y.value=!1,await b({...c.value}),_.value=!1}},J=async()=>{var t,e,u,a,l;if(f.value.length){_.value=!0;try{const{data:n,error:p}=await C.products.delete({params:{id:f.value.join(",")}});if(((t=n.value)==null?void 0:t.status)==="success")g.success(`Đã xoá ${f.value.length} sản phẩm`),f.value=[];else throw new Error(((u=(e=p.value)==null?void 0:e.data)==null?void 0:u.message)||"Thêm mới không thành công")}catch(n){g.error(n.message||((l=(a=n.response)==null?void 0:a.data)==null?void 0:l.message)||"Đã xảy ra lỗi khi lưu thông tin")}finally{await b({...c.value}),_.value=!1}}},Q=async t=>{var e,u,a,l,n;_.value=!0;try{const{data:p,error:w}=await C.products.delete({params:{id:t}});if(((e=p.value)==null?void 0:e.status)==="success")g.success("Xoá sản phẩm thành công!");else throw new Error(((a=(u=w.value)==null?void 0:u.data)==null?void 0:a.message)||"Thêm mới không thành công")}catch(p){g.error(p.message||((n=(l=p.response)==null?void 0:l.data)==null?void 0:n.message)||"Đã xảy ra lỗi khi lưu thông tin")}finally{await b({...c.value}),_.value=!1}},U=()=>{y.value=!1,m.value={name:"",price:0},k.value=null},W=t=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t);return[E,F]=ae(()=>b({...c.value})),await E,F(),(t,e)=>{const u=ne,a=le,l=me,n=pe,p=oe,w=ue,d=ce,T=ie,Y=re;return S(),D("div",de,[v("div",he,[e[8]||(e[8]=v("div",{class:"mb-6"},[v("h1",{class:"text-xl font-bold text-gray-800"},"Quản lý sản phẩm"),v("p",{class:"text-gray-600 text-sm"},"Danh sách và quản lý các sản phẩm của bạn")],-1)),v("div",_e,[v("div",ve,[r(u,{value:s(B),"onUpdate:value":e[0]||(e[0]=o=>X(B)?B.value=o:null),placeholder:"Tìm kiếm sản phẩm...","enter-button":"","allow-clear":"",class:"w-full md:w-80",onSearch:G},null,8,["value"]),v("div",ge,[s(I).role==="admin"?(S(),$(l,{key:0,title:"Bạn chắc chắn muốn xoá?","ok-text":"Xoá","cancel-text":"Huỷ",onConfirm:J},{default:i(()=>[r(a,{danger:"",disabled:!s(f).length,class:"flex items-center gap-1"},{default:i(()=>e[4]||(e[4]=[x(" Xoá đã chọn ")])),_:1,__:[4]},8,["disabled"])]),_:1})):V("",!0),r(a,{type:"primary",onClick:L,class:"flex items-center gap-1"},{default:i(()=>e[5]||(e[5]=[x(" Thêm sản phẩm ")])),_:1,__:[5]})])])]),v("div",fe,[r(n,{columns:R,"data-source":s(A),loading:s(z),pagination:s(j),"row-selection":{selectedRowKeys:s(f),onChange:K},"row-key":"id",size:"small",onChange:q,bordered:""},{bodyCell:i(({column:o,record:N})=>[o.key==="price"?(S(),D(se,{key:0},[x(O(W(N.price)),1)],64)):V("",!0),o.key==="actions"?(S(),D("div",ye,[r(a,{type:"text",size:"small",onClick:xe=>P(N)},{default:i(()=>e[6]||(e[6]=[x(" Sửa ")])),_:2,__:[6]},1032,["onClick"]),s(I).role==="admin"?(S(),$(l,{key:0,title:"Bạn chắc chắn muốn xoá?","ok-text":"Xoá","cancel-text":"Huỷ",onConfirm:()=>Q(N.id)},{default:i(()=>[r(a,{type:"text",size:"small",danger:"",class:"hover:bg-red-50 px-1"},{default:i(()=>e[7]||(e[7]=[x(" Xoá ")])),_:1,__:[7]})]),_:2},1032,["onConfirm"])):V("",!0)])):V("",!0)]),_:1},8,["data-source","loading","pagination","row-selection"])])]),r(Y,{visible:s(y),"onUpdate:visible":e[3]||(e[3]=o=>X(y)?y.value=o:null),title:s(k)?"Sửa sản phẩm":"Thêm sản phẩm mới",onOk:M,onCancel:U,"confirm-loading":s(_),width:"500px","destroy-on-close":!0},{footer:i(()=>[r(a,{key:"back",onClick:U},{default:i(()=>e[9]||(e[9]=[x("Huỷ")])),_:1,__:[9]}),r(a,{key:"submit",type:"primary",loading:s(_),onClick:M},{default:i(()=>[x(O(s(k)?"Cập nhật":"Thêm mới"),1)]),_:1},8,["loading"])]),default:i(()=>[r(T,{layout:"vertical",model:s(m)},{default:i(()=>[r(w,{label:"Tên sản phẩm",name:"name",rules:[{required:!0,message:"Vui lòng nhập tên sản phẩm"}]},{default:i(()=>[r(p,{value:s(m).name,"onUpdate:value":e[1]||(e[1]=o=>s(m).name=o),placeholder:"Nhập tên sản phẩm"},null,8,["value"])]),_:1}),r(w,{label:"Giá (VND)",name:"price",rules:[{required:!0,message:"Vui lòng nhập giá sản phẩm"}]},{default:i(()=>[r(d,{value:s(m).price,"onUpdate:value":e[2]||(e[2]=o=>s(m).price=o),min:0,formatter:o=>`${o}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:o=>o.replace(/\$\s?|(,*)/g,""),style:{width:"100%"}},null,8,["value","formatter","parser"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","confirm-loading"])])}}};export{Fe as default};
