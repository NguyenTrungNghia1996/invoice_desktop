import{u as C}from"./BMHoVKzN.js";import{o as w,e as x,T as v,y,z as g,r as A,a as E,E as N,C as B,A as U,B as f,I as d,H as $}from"./CXt9CpHx.js";const D=["id"],M={__name:"TinyMCE",props:{modelValue:{type:String,default:""},id:{type:String,default:"tinymce-editor"},height:{type:Number,default:200},menubar:{type:Boolean,default:!1},plugins:{type:Array,default:()=>["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","code","help","wordcount"]},toolbar:{type:String,default:"undo redo | blocks | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | code"}},emits:["update:modelValue"],setup(s,{emit:l}){const{RestApi:c}=C(),n=s,m=l;let t=null;function r(e,i,b){if(b.filetype==="image"){const o=document.createElement("input");o.setAttribute("type","file"),o.setAttribute("accept","image/*"),o.onchange=async function(){const a=this.files[0];if(a)try{const u=new Date().getTime(),_=a.name.split(".").pop(),h=a.name.substring(0,a.name.lastIndexOf(".")),k=`${u}_${h}.${_}`,p=new File([a],k,{type:a.type}),V=await c.upload_s3(p.name,p,{acl:"public-read",encoding:"blob",content_type:a.type,bucket:"website"});e(V,{alt:a.name})}catch(u){console.error("S3 upload error:",u),alert("Upload ảnh thất bại. Vui lòng thử lại.")}},o.click()}}return w(()=>{const e=document.createElement("script");e.src="/tinymce/tinymce.min.js",e.referrerPolicy="origin",e.onload=()=>{tinymce.init({license_key:"gpl",branding:!1,selector:`#${n.id}`,height:n.height,menubar:n.menubar,plugins:n.plugins,toolbar:n.toolbar,skin_url:"/tinymce/skins/ui/oxide",content_css:"/tinymce/skins/content/default/content.min.css",file_picker_types:"image",toolbar_mode:"sliding",file_picker_callback:r,setup(i){t=i,i.on("init",()=>{i.setContent(n.modelValue||"")}),i.on("Change KeyUp Undo Redo",()=>{m("update:modelValue",i.getContent())})}})},document.head.appendChild(e)}),x(()=>{t&&(t.destroy(),t=null)}),v(()=>n.modelValue,e=>{t&&t.getContent()!==e&&t.setContent(e||"")}),(e,i)=>(g(),y("textarea",{id:s.id},null,8,D))}},j={__name:"tinymce",setup(s){const l=A(""),{$dayjs:c}=E(),n=c().format("DD/MM/YYYY");return(m,t)=>{const r=M;return g(),y("div",null,[N(f(d(l))+" ",1),B(r,{modelValue:d(l),"onUpdate:modelValue":t[0]||(t[0]=e=>$(l)?l.value=e:null),class:"w-full"},null,8,["modelValue"]),U("div",null,"Dayjs"+f(d(n)),1)])}}};export{j as default};
