import{u as ee}from"./BMHoVKzN.js";import{ao as te,G as R,r as i,k as ae,y as q,A as m,C as s,H as A,I as t,ar as T,L as x,D as n,q as ne,z as y,E as p,B as se,M as f}from"./CXt9CpHx.js";import{_ as le,B as oe,I as re,f as ue}from"./BiSs8nCf.js";import{M as ie}from"./BJXH78id.js";import{F as ce,_ as de}from"./DfpqhckG.js";import{_ as me,S as pe,a as _e}from"./BydhxjDa.js";import{_ as ge}from"./DHdZDWaO.js";import"./_QCYz8aP.js";import"./BQfcw6q0.js";import"./C_MGbZ-_.js";const ve={class:"min-h-screen bg-white p-4"},fe={class:"bg-white p-3 rounded-lg shadow-sm mb-4"},he={class:"flex flex-col md:flex-row md:items-center justify-between gap-2"},ye={class:"flex items-center gap-2"},we={class:"bg-white"},xe={key:0,class:"flex gap-1"},Ne={__name:"users",async setup(ke){let k,b;const{RestApi:w}=ee(),C=te();C.role!=="admin"&&([k,b]=R(()=>ne("/create_invoices")),await k,b());const o=i({page:1,limit:10,search:""}),S=i(""),U=i([]),D=i(0),z=i(!1),c=i(!1),_=i([]),g=i(!1),v=i(null),r=i({username:"",password:"",role:""}),H=[{title:"Tên đăng nhập",dataIndex:"username",key:"username",ellipsis:!0},{title:"Role",dataIndex:"role",key:"role",width:"120px",align:"center"},{title:"Hành động",key:"actions",width:"120px",align:"center"}],I=ae(()=>({current:o.value.page,pageSize:o.value.limit,total:D.value,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:a=>`Tổng ${a} người dùng`,size:"small"})),h=async a=>{var e;z.value=!0;try{const{data:l}=await w.users.list();U.value=((e=l.value)==null?void 0:e.data)||[]}finally{z.value=!1}},X=async a=>{o.value.page=a.current,o.value.limit=a.pageSize,await h({...o.value})},F=async()=>{o.value.page=1,o.value.search=S.value,await h({...o.value})},O=a=>{_.value=a},$=()=>{v.value=null,r.value={username:"",password:"",role:""},g.value=!0},j=a=>{v.value=a,r.value={id:a.id,username:a.username,role:a.role},g.value=!0},V=async()=>{var a,e;c.value=!0;try{if(v.value){const{data:l}=await w.users.update({body:{...r.value}});if(((a=l.value)==null?void 0:a.status)==="success")f.success("Cập nhật thành công");else throw new Error("Không thể cập nhật")}else{const l={...r.value};delete l.id;const{data:d}=await w.users.create({body:l});if(((e=d.value)==null?void 0:e.status)==="success")f.success("Thêm mới thành công");else throw new Error("Không thể thêm mới")}}catch(l){f.error(l.message||"Đã xảy ra lỗi")}finally{g.value=!1,await h({...o.value}),c.value=!1}},L=async()=>{var a;if(_.value.length){c.value=!0;try{const{data:e}=await w.users.delete({params:{id:_.value.join(",")}});if(((a=e.value)==null?void 0:a.status)==="success")f.success(`Đã xoá ${_.value.length} người dùng`),_.value=[];else throw new Error("Không thể xoá")}catch(e){f.error(e.message||"Đã xảy ra lỗi")}finally{await h({...o.value}),c.value=!1}}},G=async a=>{var e;c.value=!0;try{const{data:l}=await w.users.delete({params:{id:a}});if(((e=l.value)==null?void 0:e.status)==="success")f.success("Xoá thành công");else throw new Error("Không thể xoá")}catch(l){f.error(l.message||"Đã xảy ra lỗi")}finally{await h({...o.value}),c.value=!1}},E=()=>{g.value=!1,r.value={username:"",password:"",role:""},v.value=null};return[k,b]=R(()=>h({...o.value})),await k,b(),(a,e)=>{const l=le,d=oe,K=ge,Q=me,J=re,B=de,P=ue,M=_e,W=pe,Y=ce,Z=ie;return y(),q("div",ve,[m("div",null,[e[9]||(e[9]=m("div",{class:"mb-6"},[m("h1",{class:"text-xl font-bold text-gray-800"},"Quản lý người dùng"),m("p",{class:"text-gray-600 text-sm"},"Danh sách tài khoản hệ thống")],-1)),m("div",fe,[m("div",he,[s(l,{value:t(S),"onUpdate:value":e[0]||(e[0]=u=>A(S)?S.value=u:null),placeholder:"Tìm kiếm...","enter-button":"","allow-clear":"",class:"w-full md:w-80",onSearch:F},null,8,["value"]),m("div",ye,[t(C).role==="admin"?(y(),T(K,{key:0,title:"Bạn chắc chắn muốn xoá?","ok-text":"Xoá","cancel-text":"Huỷ",onConfirm:L},{default:n(()=>[s(d,{danger:"",disabled:!t(_).length,class:"flex items-center gap-1"},{default:n(()=>e[5]||(e[5]=[p("Xoá đã chọn")])),_:1,__:[5]},8,["disabled"])]),_:1})):x("",!0),t(C).role==="admin"?(y(),T(d,{key:1,type:"primary",onClick:$,class:"flex items-center gap-1"},{default:n(()=>e[6]||(e[6]=[p("Thêm người dùng")])),_:1,__:[6]})):x("",!0)])])]),m("div",we,[s(Q,{columns:H,"data-source":t(U),loading:t(z),pagination:t(I),"row-selection":{selectedRowKeys:t(_),onChange:O},"row-key":"id",size:"small",onChange:X,bordered:""},{bodyCell:n(({column:u,record:N})=>[u.key==="actions"?(y(),q("div",xe,[s(d,{type:"text",size:"small",onClick:be=>j(N)},{default:n(()=>e[7]||(e[7]=[p("Sửa")])),_:2,__:[7]},1032,["onClick"]),t(C).role==="admin"?(y(),T(K,{key:0,title:"Bạn chắc chắn muốn xoá?","ok-text":"Xoá","cancel-text":"Huỷ",onConfirm:()=>G(N.id)},{default:n(()=>[s(d,{type:"text",size:"small",danger:"",class:"hover:bg-red-50 px-1"},{default:n(()=>e[8]||(e[8]=[p("Xoá")])),_:1,__:[8]})]),_:2},1032,["onConfirm"])):x("",!0)])):x("",!0)]),_:1},8,["data-source","loading","pagination","row-selection"])])]),s(Z,{open:t(g),"onUpdate:open":e[4]||(e[4]=u=>A(g)?g.value=u:null),title:t(v)?"Sửa người dùng":"Thêm người dùng mới",onOk:V,onCancel:E,"confirm-loading":t(c),width:"500px","destroy-on-close":!0},{footer:n(()=>[s(d,{key:"back",onClick:E},{default:n(()=>e[12]||(e[12]=[p("Huỷ")])),_:1,__:[12]}),s(d,{key:"submit",type:"primary",loading:t(c),onClick:V},{default:n(()=>[p(se(t(v)?"Cập nhật":"Thêm mới"),1)]),_:1},8,["loading"])]),default:n(()=>[s(Y,{layout:"vertical",model:t(r)},{default:n(()=>[s(B,{label:"Tên đăng nhập",name:"username",rules:[{required:!0,message:"Vui lòng nhập tên đăng nhập"}]},{default:n(()=>[s(J,{value:t(r).username,"onUpdate:value":e[1]||(e[1]=u=>t(r).username=u),placeholder:"Nhập tên đăng nhập"},null,8,["value"])]),_:1}),t(v)?x("",!0):(y(),T(B,{key:0,label:"Mật khẩu",name:"password",rules:[{required:!0,message:"Vui lòng nhập mật khẩu"}]},{default:n(()=>[s(P,{value:t(r).password,"onUpdate:value":e[2]||(e[2]=u=>t(r).password=u),placeholder:"Nhập mật khẩu"},null,8,["value"])]),_:1})),s(B,{label:"Role",name:"role",rules:[{required:!0,message:"Vui lòng chọn role"}]},{default:n(()=>[s(W,{value:t(r).role,"onUpdate:value":e[3]||(e[3]=u=>t(r).role=u),placeholder:"Chọn quyền"},{default:n(()=>[s(M,{value:"admin"},{default:n(()=>e[10]||(e[10]=[p("admin")])),_:1,__:[10]}),s(M,{value:"user"},{default:n(()=>e[11]||(e[11]=[p("user")])),_:1,__:[11]})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirm-loading"])])}}};export{Ne as default};
